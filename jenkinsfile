 node{
 stage('Deploy'){
	 sh """	
	 	
		
		
		export length=\$(kubectl get deployments --kubeconfig ~/.kube/config | grep mywebapp | wc -l)
		 if [ \$length -gt 0 ]
		 then
		 kubectl rollout restart deployment/mywebapp --kubeconfig ~/.kube/config
		 kubectl rollout status deployment/mywebapp --kubeconfig ~/.kube/config
		 else
		 kubectl create deployment mywebapp --image shrutshah/mywebapp:v1 --kubeconfig ~/.kube/config
		 kubectl scale deployment mywebapp --replicas=3 --kubeconfig ~/.kube/config
		 sudo kubectl expose deployment mywebapp --port 8080 --type NodePort --kubeconfig ~/.kube/config
		 fi
		
		
        """
 }  
}      
